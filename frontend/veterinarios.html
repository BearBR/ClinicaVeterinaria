<!doctype html>
<html lang="pt-br">
<head>
    <meta charset="utf-8" />
    <title>Veterin√°rios - Clinica Vet</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin />
    <link
        href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
        rel="stylesheet"
    />
</head>
<body class="bg-light">
    <nav class="navbar navbar-expand-lg navbar-dark bg-info">
        <div class="container-fluid">
            <a class="btn btn-outline-light me-2" href="/">‚Üê Voltar</a>
            <a class="navbar-brand" href="/">
                üêæ Cl√≠nica Veterin√°ria Unimar
            </a>
            
            <button 
                class="navbar-toggler" 
                type="button" 
                data-bs-toggle="collapse" 
                data-bs-target="#navbarNav"
            >
                <span class="navbar-toggler-icon"></span>
            </button>
            
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="/">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/donos">Donos</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/pets">Pets</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/consultas">Consultas</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="/veterinarios">Veterin√°rios</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <main class="container my-4">
        <h1 class="mb-4">Gerenciamento de Veterin√°rios</h1>

        <form id="form-veterinario" class="card border-0 shadow-sm mb-4">
            <div class="card-header bg-info text-white">
                <h2 class="h5 mb-0">Cadastro de Veterin√°rio</h2>
            </div>
            <div class="card-body">
                <div class="row g-3">
                    <div class="col-md-6">
                        <label class="form-label">Nome Completo</label>
                        <input
                            class="form-control"
                            name="nome"
                            placeholder="Nome do veterin√°rio"
                            required
                        />
                    </div>
                    
                    <div class="col-md-3">
                        <label class="form-label">CRMV</label>
                        <input
                            class="form-control"
                            name="crmv"
                            placeholder="N√∫mero do CRMV"
                            required
                        />
                    </div>

                    <div class="col-md-3">
                        <label class="form-label">Especialidade</label>
                        <select class="form-select" name="especialidade" required>
                            <option value="">Selecione</option>
                            <option value="clinico">Cl√≠nico Geral</option>
                            <option value="cirurgiao">Cirurgi√£o</option>
                            <option value="dermatologia">Dermatologia</option>
                            <option value="ortopedia">Ortopedia</option>
                            <option value="cardiologia">Cardiologia</option>
                            <option value="outro">Outra</option>
                        </select>
                    </div>

                    <div class="col-md-6">
                        <label class="form-label">Email</label>
                        <input
                            type="email"
                            class="form-control"
                            name="email"
                            placeholder="email@exemplo.com"
                        />
                    </div>

                    <div class="col-md-6">
                        <label class="form-label">Telefone</label>
                        <input
                            class="form-control"
                            name="telefone"
                            placeholder="(99) 99999-9999"
                        />
                    </div>

                    <div class="col-12">
                        <label class="form-label">Observa√ß√µes</label>
                        <textarea
                            class="form-control"
                            name="observacoes"
                            rows="2"
                            placeholder="Observa√ß√µes adicionais"
                        ></textarea>
                    </div>

                    <div class="col-12 d-grid gap-2">
                        <button class="btn btn-info text-white" type="submit" id="submit-btn">
                            Salvar Veterin√°rio
                        </button>
                        <button class="btn btn-secondary" type="button" id="cancel-btn" style="display:none;" onclick="cancelarEdicao()">
                            Cancelar
                        </button>
                    </div>
                </div>
            </div>
        </form>

        <div class="card border-0 shadow-sm">
            <div class="card-header bg-info text-white">
                <h3 class="h5 mb-0">Veterin√°rios Cadastrados</h3>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-striped table-hover">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Nome</th>
                                <th>CRMV</th>
                                <th>Especialidade</th>
                                <th>Contato</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="tbody-veterinarios"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <script>
            const API = 'http://127.0.0.1:5000';
            let editandoId = null;

            function carregarVeterinarios() {
                fetch(API + '/api/veterinarios')
                    .then(r => r.json())
                    .then(vets => {
                        let html = '';
                        for(let i = 0; i < vets.length; i++) {
                            let v = vets[i];
                            html += `
                                <tr>
                                    <td>${v.id}</td>
                                    <td><strong>${v.nome}</strong></td>
                                    <td>${v.crmv || ''}</td>
                                    <td>${v.especialidade || ''}</td>
                                    <td>
                                        ${v.email ? '<div>' + v.email + '</div>' : ''}
                                        ${v.telefone ? '<div class="text-muted">' + v.telefone + '</div>' : ''}
                                    </td>
                                    <td>
                                        <button class="btn btn-warning btn-sm me-1" onclick="editarVet(${v.id})">Editar</button>
                                        <button class="btn btn-danger btn-sm" onclick="deletarVet(${v.id})">Excluir</button>
                                    </td>
                                </tr>
                            `;
                        }
                        document.getElementById('tbody-veterinarios').innerHTML = html;
                    });
            }

            window.deletarVet = function(id) {
                if(!confirm('Tem certeza?')) return;
                
                fetch(API + '/api/veterinarios/' + id, { method: 'DELETE' })
                    .then(r => {
                        if(r.ok) {
                            alert('Veterin√°rio excluido!');
                            carregarVeterinarios();
                        } else {
                            alert('Erro ao excluir');
                        }
                    });
            };

            window.editarVet = function(id) {
                fetch(API + '/api/veterinarios/' + id)
                    .then(r => r.json())
                    .then(vet => {
                        let form = document.getElementById('form-veterinario');
                        form.nome.value = vet.nome || '';
                        form.crmv.value = vet.crmv || '';
                        form.especialidade.value = vet.especialidade || '';
                        form.email.value = vet.email || '';
                        form.telefone.value = vet.telefone || '';
                        form.observacoes.value = vet.observacoes || '';
                        
                        editandoId = id;
                        document.getElementById('submit-btn').textContent = 'Atualizar';
                        document.getElementById('cancel-btn').style.display = 'block';
                    });
            };

            window.cancelarEdicao = function() {
                editandoId = null;
                document.getElementById('form-veterinario').reset();
                document.getElementById('submit-btn').textContent = 'Salvar Veterin√°rio';
                document.getElementById('cancel-btn').style.display = 'none';
            };

            document.getElementById('form-veterinario').addEventListener('submit', function(e) {
                e.preventDefault();
                
                let fd = new FormData(e.target);
                let dados = Object.fromEntries(fd);
                
                let url = API + '/api/veterinarios';
                let metodo = 'POST';
                
                if(editandoId) {
                    url = url + '/' + editandoId;
                    metodo = 'PUT';
                }
                
                fetch(url, {
                    method: metodo,
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(dados)
                })
                .then(r => {
                    if(r.ok) {
                        alert('Salvo!');
                        editandoId = null;
                        document.getElementById('submit-btn').textContent = 'Salvar Veterin√°rio';
                        document.getElementById('cancel-btn').style.display = 'none';
                        e.target.reset();
                        carregarVeterinarios();
                    } else {
                        alert('Erro ao salvar');
                    }
                });
            });

            document.addEventListener('DOMContentLoaded', function() {
                carregarVeterinarios();
            });
        </script>
    </main>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/inputmask/5.0.6/inputmask.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const telefoneInput = document.querySelector('input[name="telefone"]');
            Inputmask("(99) 99999-9999").mask(telefoneInput);

            const crmvInput = document.querySelector('input[name="crmv"]');
            Inputmask("99999-AA").mask(crmvInput);
        });
    </script>
</body>
</html>