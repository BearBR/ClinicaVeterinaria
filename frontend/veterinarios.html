<!doctype html>
<html lang="pt-br">
<head>
    <!-- Configura√ß√£o de codifica√ß√£o de caracteres -->
    <meta charset="utf-8" />
    
    <!-- T√≠tulo da p√°gina -->
    <title>Gerenciamento de Veterin√°rios - Cl√≠nica Veterin√°ria Unimar</title>
    
    <!-- Responsividade -->
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    
    <!-- Meta description -->
    <meta name="description" content="M√≥dulo de cadastro e gerenciamento de veterin√°rios" />
    
    <!-- Bootstrap CSS -->
    <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin />
    <link
        href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
        rel="stylesheet"
    />
</head>
<body class="bg-light">
    <!-- 
    ========================================================================
    BARRA DE NAVEGA√á√ÉO
    ========================================================================
    -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-info" role="navigation">
        <div class="container-fluid">
            <a class="btn btn-outline-light me-2" href="/" aria-label="Voltar para Home">‚Üê Voltar</a>
            <!-- Logo/Marca da cl√≠nica -->
            <a class="navbar-brand" href="/">
                üêæ Cl√≠nica Veterin√°ria Unimar
            </a>
            
            <!-- Bot√£o hamb√∫rguer para mobile -->
            <button 
                class="navbar-toggler" 
                type="button" 
                data-bs-toggle="collapse" 
                data-bs-target="#navbarNav"
                aria-controls="navbarNav"
                aria-expanded="false"
                aria-label="Alternar navega√ß√£o"
            >
                <span class="navbar-toggler-icon"></span>
            </button>
            
            <!-- Itens de navega√ß√£o -->
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="/">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/donos">Donos</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/pets">Pets</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/consultas">Consultas</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" aria-current="page" href="/veterinarios">Veterin√°rios</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- 
    ========================================================================
    CONTE√öDO PRINCIPAL
    ========================================================================
    -->
    <main class="container my-4" role="main">
        <!-- T√≠tulo da p√°gina -->
        <h1 class="mb-4">Gerenciamento de Veterin√°rios</h1>

        <!-- Formul√°rio de Cadastro/Edi√ß√£o -->
        <form id="form-veterinario" class="card border-0 shadow-sm mb-4">
            <div class="card-header bg-info text-white">
                <h2 class="h5 mb-0">Cadastro de Veterin√°rio</h2>
            </div>
            <div class="card-body">
                <div class="row g-3">
                    <div class="col-md-6">
                        <label class="form-label">Nome Completo</label>
                        <input
                            class="form-control"
                            name="nome"
                            placeholder="Nome do veterin√°rio"
                            required
                        />
                    </div>
                    
                    <div class="col-md-3">
                        <label class="form-label">CRMV</label>
                        <input
                            class="form-control"
                            name="crmv"
                            placeholder="N√∫mero do CRMV"
                            required
                        />
                    </div>

                    <div class="col-md-3">
                        <label class="form-label">Especialidade</label>
                        <select class="form-select" name="especialidade" required>
                            <option value="">Selecione</option>
                            <option value="clinico">Cl√≠nico Geral</option>
                            <option value="cirurgiao">Cirurgi√£o</option>
                            <option value="dermatologia">Dermatologia</option>
                            <option value="ortopedia">Ortopedia</option>
                            <option value="cardiologia">Cardiologia</option>
                            <option value="outro">Outra</option>
                        </select>
                    </div>

                    <div class="col-md-6">
                        <label class="form-label">Email</label>
                        <input
                            type="email"
                            class="form-control"
                            name="email"
                            placeholder="email@exemplo.com"
                        />
                    </div>

                    <div class="col-md-6">
                        <label class="form-label">Telefone</label>
                        <input
                            class="form-control"
                            name="telefone"
                            placeholder="(99) 99999-9999"
                        />
                    </div>

                    <div class="col-12">
                        <label class="form-label">Observa√ß√µes</label>
                        <textarea
                            class="form-control"
                            name="observacoes"
                            rows="2"
                            placeholder="Observa√ß√µes adicionais"
                        ></textarea>
                    </div>

                    <div class="col-12 d-grid gap-2">
                        <button class="btn btn-info text-white" type="submit" id="submit-btn">
                            Salvar Veterin√°rio
                        </button>
                        <button class="btn btn-secondary" type="button" id="cancel-btn" style="display:none;" onclick="cancelarEdicao()">
                            Cancelar
                        </button>
                    </div>
                </div>
            </div>
        </form>

        <!-- Tabela de Veterin√°rios -->
        <div class="card border-0 shadow-sm">
            <div class="card-header bg-info text-white">
                <h3 class="h5 mb-0">Veterin√°rios Cadastrados</h3>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-striped table-hover">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Nome</th>
                                <th>CRMV</th>
                                <th>Especialidade</th>
                                <th>Contato</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="tbody-veterinarios"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Script para manipula√ß√£o do CRUD -->
        <script>
            document.addEventListener('DOMContentLoaded', function() {
                const API = 'http://127.0.0.1:5000';
                let editandoId = null;

                // Carregar lista de veterin√°rios
                async function carregarVeterinarios() {
                    const r = await fetch(`${API}/api/veterinarios`);
                    const veterinarios = await r.json();
                    document.getElementById('tbody-veterinarios').innerHTML =
                        veterinarios.map(function(v) {
                            return `
                                <tr>
                                    <td>${v.id}</td>
                                    <td><strong>${v.nome}</strong></td>
                                    <td>${v.crmv || ''}</td>
                                    <td>${v.especialidade || ''}</td>
                                    <td>
                                        ${v.email ? `<div>${v.email}</div>` : ''}
                                        ${v.telefone ? `<div class="text-muted">${v.telefone}</div>` : ''}
                                    </td>
                                    <td>
                                        <button class="btn btn-warning btn-sm me-1" onclick="editarVeterinario(${v.id})">
                                            Editar
                                        </button>
                                        <button class="btn btn-danger btn-sm" onclick="deletarVeterinario(${v.id})">
                                            Excluir
                                        </button>
                                    </td>
                                </tr>
                            `;
                        }).join('');
                }

                // Deletar veterin√°rio
                window.deletarVeterinario = async function(id) {
                    if (!confirm('Deseja realmente excluir este veterin√°rio?')) return;
                    const response = await fetch(`${API}/api/veterinarios/${id}`, { method: 'DELETE' });
                    if (!response.ok) {
                        alert('Erro ao excluir o veterin√°rio.');
                        return;
                    }
                    alert('Veterin√°rio exclu√≠do com sucesso!');
                    carregarVeterinarios();
                };

                // Editar veterin√°rio
                window.editarVeterinario = async function(id) {
                    const r = await fetch(`${API}/api/veterinarios/${id}`);
                    const vet = await r.json();
                    const form = document.getElementById('form-veterinario');
                    form.nome.value = vet.nome || '';
                    form.crmv.value = vet.crmv || '';
                    form.especialidade.value = vet.especialidade || '';
                    form.email.value = vet.email || '';
                    form.telefone.value = vet.telefone || '';
                    form.observacoes.value = vet.observacoes || '';
                    editandoId = id;
                    document.getElementById('submit-btn').textContent = 'Atualizar Veterin√°rio';
                    document.getElementById('cancel-btn').style.display = 'block';
                };

                // Cancelar edi√ß√£o
                window.cancelarEdicao = function() {
                    editandoId = null;
                    document.getElementById('form-veterinario').reset();
                    document.getElementById('submit-btn').textContent = 'Salvar Veterin√°rio';
                    document.getElementById('cancel-btn').style.display = 'none';
                };

                // Submit do formul√°rio
                document.getElementById('form-veterinario').addEventListener('submit', async function(e) {
                    e.preventDefault();
                    const fd = new FormData(e.target);
                    const vetData = Object.fromEntries(fd);

                    if (editandoId) {
                        await fetch(`${API}/api/veterinarios/${editandoId}`, {
                            method: 'PUT',
                            headers: {'Content-Type': 'application/json'},
                            body: JSON.stringify(vetData)
                        });
                        editandoId = null;
                        document.getElementById('submit-btn').textContent = 'Salvar Veterin√°rio';
                        document.getElementById('cancel-btn').style.display = 'none';
                    } else {
                        await fetch(`${API}/api/veterinarios`, {
                            method: 'POST',
                            headers: {'Content-Type': 'application/json'},
                            body: JSON.stringify(vetData)
                        });
                    }

                    e.target.reset();
                    carregarVeterinarios();
                });

                // Inicializa√ß√£o
                carregarVeterinarios();
            });
        </script>
    </main>

    <!-- InputMask para formata√ß√£o de campos -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/inputmask/5.0.6/inputmask.min.js"></script>

    <!-- Bootstrap JavaScript Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Aplicar m√°scaras -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // M√°scara para telefone
            const telefoneInput = document.querySelector('input[name="telefone"]');
            Inputmask("(99) 99999-9999").mask(telefoneInput);

            // M√°scara para CRMV (formato 00000-UF)
            const crmvInput = document.querySelector('input[name="crmv"]');
            Inputmask("99999-AA").mask(crmvInput);
        });
    </script>
</body>
</html>