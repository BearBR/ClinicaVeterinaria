<!doctype html>
<html lang="pt-br">
<head>
    <!-- Configura√ß√£o de codifica√ß√£o de caracteres -->
    <meta charset="utf-8" />
    
    <!-- T√≠tulo da p√°gina -->
    <title>Gerenciamento de Pets - Cl√≠nica Veterin√°ria Unimar</title>
    
    <!-- Responsividade -->
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    
    <!-- Meta description -->
    <meta name="description" content="M√≥dulo de cadastro e gerenciamento de animais de estima√ß√£o" />
    
    <!-- Bootstrap CSS -->
    <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin />
    <link
        href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
        rel="stylesheet"
    />
</head>
<body class="bg-light">
    <!-- 
    ========================================================================
    BARRA DE NAVEGA√á√ÉO
    ========================================================================
    -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-success" role="navigation">
        <div class="container-fluid">
            <!-- Logo/Marca da cl√≠nica -->
            <a class="navbar-brand" href="/">
                üêæ Cl√≠nica Veterin√°ria Unimar
            </a>
            
            <!-- Bot√£o hamb√∫rguer para mobile -->
            <button 
                class="navbar-toggler" 
                type="button" 
                data-bs-toggle="collapse" 
                data-bs-target="#navbarNav"
                aria-controls="navbarNav"
                aria-expanded="false"
                aria-label="Alternar navega√ß√£o"
            >
                <span class="navbar-toggler-icon"></span>
            </button>
            
            <!-- Itens de navega√ß√£o -->
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="/">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/donos">Donos</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" aria-current="page" href="/pets">Pets</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/veterinarios">Veterin√°rios</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- 
    ========================================================================
    CONTE√öDO PRINCIPAL
    ========================================================================
    -->
    <main class="container my-4" role="main">
        <!-- T√≠tulo da p√°gina -->
        <h1 class="mb-4">Gerenciamento de Pets</h1>

        <!-- Formul√°rio de Cadastro/Edi√ß√£o -->
        <form id="form-pet" class="card border-0 shadow-sm mb-4">
            <div class="card-header bg-success text-white">
                <h2 class="h5 mb-0">Cadastro de Pet</h2>
            </div>
            <div class="card-body">
                <div class="row g-3">
                    <div class="col-md-6">
                        <label class="form-label">Nome do Pet</label>
                        <input
                            class="form-control"
                            name="nome"
                            placeholder="Nome do animal"
                            required
                        />
                    </div>
                    
                    <div class="col-md-6">
                        <label class="form-label">Dono</label>
                        <select class="form-select" name="dono_id" required>
                            <option value="">Selecione o dono</option>
                        </select>
                    </div>

                    <div class="col-md-4">
                        <label class="form-label">Esp√©cie</label>
                        <select class="form-select" name="especie" required>
                            <option value="">Selecione</option>
                            <option value="cachorro">Cachorro</option>
                            <option value="gato">Gato</option>
                            <option value="ave">Ave</option>
                            <option value="roedor">Roedor</option>
                            <option value="outro">Outro</option>
                        </select>
                    </div>

                    <div class="col-md-4">
                        <label class="form-label">Ra√ßa</label>
                        <input
                            class="form-control"
                            name="raca"
                            placeholder="Ra√ßa do animal"
                        />
                    </div>

                    <div class="col-md-2">
                        <label class="form-label">Idade (anos)</label>
                        <input
                            type="number"
                            class="form-control"
                            name="idade"
                            min="0"
                            max="30"
                        />
                    </div>

                    <div class="col-md-2">
                        <label class="form-label">Peso (kg)</label>
                        <input
                            type="number"
                            class="form-control"
                            name="peso"
                            step="0.1"
                            min="0"
                            max="100"
                        />
                    </div>

                    <div class="col-12">
                        <label class="form-label">Observa√ß√µes</label>
                        <textarea
                            class="form-control"
                            name="observacoes"
                            rows="2"
                            placeholder="Observa√ß√µes importantes sobre o pet"
                        ></textarea>
                    </div>

                    <div class="col-12 d-grid gap-2">
                        <button class="btn btn-success" type="submit" id="submit-btn">
                            Salvar Pet
                        </button>
                        <button class="btn btn-secondary" type="button" id="cancel-btn" style="display:none;" onclick="cancelarEdicao()">
                            Cancelar
                        </button>
                    </div>
                </div>
            </div>
        </form>

        <!-- Tabela de Pets -->
        <div class="card border-0 shadow-sm">
            <div class="card-header bg-success text-white">
                <h3 class="h5 mb-0">Pets Cadastrados</h3>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-striped table-hover">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Nome</th>
                                <th>Dono</th>
                                <th>Esp√©cie</th>
                                <th>Ra√ßa</th>
                                <th>Idade</th>
                                <th>Peso</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="tbody-pets"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Script para manipula√ß√£o do CRUD -->
        <script>
            document.addEventListener('DOMContentLoaded', function() {
                const API = 'http://127.0.0.1:5000';
                let editandoId = null;

                // Carregar lista de donos para o select
                async function carregarDonos() {
                    const r = await fetch(`${API}/api/donos`);
                    const donos = await r.json();
                    const select = document.querySelector('select[name=dono_id]');
                    select.innerHTML = '<option value="">Selecione o dono</option>' +
                        donos.map(d => `<option value="${d.id}">${d.nome}</option>`).join('');
                }

                // Carregar lista de pets
                async function carregarPets() {
                    const r = await fetch(`${API}/api/pets`);
                    const pets = await r.json();
                    document.getElementById('tbody-pets').innerHTML =
                        pets.map(function(p) {
                            return `
                                <tr>
                                    <td>${p.id}</td>
                                    <td><strong>${p.nome}</strong></td>
                                    <td>${p.dono_nome || ''}</td>
                                    <td>${p.especie || ''}</td>
                                    <td>${p.raca || ''}</td>
                                    <td>${p.idade || ''}</td>
                                    <td>${p.peso ? p.peso + ' kg' : ''}</td>
                                    <td>
                                        <button class="btn btn-warning btn-sm me-1" onclick="editarPet(${p.id})">
                                            Editar
                                        </button>
                                        <button class="btn btn-danger btn-sm" onclick="deletarPet(${p.id})">
                                            Excluir
                                        </button>
                                    </td>
                                </tr>
                            `;
                        }).join('');
                }

                // Deletar pet
                window.deletarPet = async function(id) {
                    if (!confirm('Deseja realmente excluir este pet?')) return;
                    const response = await fetch(`${API}/api/pets/${id}`, { method: 'DELETE' });
                    if (!response.ok) {
                        alert('Erro ao excluir o pet.');
                        return;
                    }
                    alert('Pet exclu√≠do com sucesso!');
                    carregarPets();
                };

                // Editar pet
                window.editarPet = async function(id) {
                    const r = await fetch(`${API}/api/pets/${id}`);
                    const pet = await r.json();
                    const form = document.getElementById('form-pet');
                    form.nome.value = pet.nome || '';
                    form.dono_id.value = pet.dono_id || '';
                    form.especie.value = pet.especie || '';
                    form.raca.value = pet.raca || '';
                    form.idade.value = pet.idade || '';
                    form.peso.value = pet.peso || '';
                    form.observacoes.value = pet.observacoes || '';
                    editandoId = id;
                    document.getElementById('submit-btn').textContent = 'Atualizar Pet';
                    document.getElementById('cancel-btn').style.display = 'block';
                };

                // Cancelar edi√ß√£o
                window.cancelarEdicao = function() {
                    editandoId = null;
                    document.getElementById('form-pet').reset();
                    document.getElementById('submit-btn').textContent = 'Salvar Pet';
                    document.getElementById('cancel-btn').style.display = 'none';
                };

                // Submit do formul√°rio
                document.getElementById('form-pet').addEventListener('submit', async function(e) {
                    e.preventDefault();
                    const fd = new FormData(e.target);
                    const petData = Object.fromEntries(fd);

                    if (editandoId) {
                        await fetch(`${API}/api/pets/${editandoId}`, {
                            method: 'PUT',
                            headers: {'Content-Type': 'application/json'},
                            body: JSON.stringify(petData)
                        });
                        editandoId = null;
                        document.getElementById('submit-btn').textContent = 'Salvar Pet';
                        document.getElementById('cancel-btn').style.display = 'none';
                    } else {
                        await fetch(`${API}/api/pets`, {
                            method: 'POST',
                            headers: {'Content-Type': 'application/json'},
                            body: JSON.stringify(petData)
                        });
                    }

                    e.target.reset();
                    carregarPets();
                });

                // Inicializa√ß√£o
                carregarDonos();
                carregarPets();
            });
        </script>
    </main>

    <!-- Bootstrap JavaScript Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
